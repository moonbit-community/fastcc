{"id":"tinyccmbt-1","title":"Rewrite tinycc in MoonBit","description":"Rewrite tinycc in MoonBit; arm64 backend only; target macOS Mach-O; compiler-only (emit .o).\n\nAll work (including future sub-issues) must stay as close as possible to refs/tinycc.","status":"in_progress","priority":2,"issue_type":"epic","created_at":"2026-01-09T14:43:50.187219+08:00","created_by":"agent","updated_at":"2026-01-10T01:39:26.013146+08:00"}
{"id":"tinyccmbt-1.1","title":"Parser/sem: remaining expressions and declarators","description":"Finish remaining C parser/sem features: comma-separated declarators, casts/sizeof, postfix ++/--, member/array initializers, bitfields/qualifiers, and enum constant evaluation, following refs/tinycc/tccgen.c.\\n\\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T02:44:39.607381+08:00","created_by":"agent","updated_at":"2026-01-10T03:40:04.938625+08:00","closed_at":"2026-01-10T03:40:04.938626+08:00","dependencies":[{"issue_id":"tinyccmbt-1.1","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T02:44:39.608242+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-1.2","title":"Preprocessor: built-in macros and extra directives","description":"Implement preprocessor built-ins (e.g., __LINE__, __FILE__, __DATE__/__TIME__ as in refs/tinycc/tccpp.c) and remaining directives (#line/#error/#warning/#pragma, include_next if applicable). Keep behavior close to refs/tinycc.","notes":"Added built-in macro expansion for __LINE__/__FILE__/__DATE__/__TIME__, #line handling with logical path/line adjustment, #error/#warning/#pragma handling, and include_next support; added preproc tests for builtins and #line.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T03:21:07.63978+08:00","created_by":"agent","updated_at":"2026-01-12T03:13:15.840379+08:00","closed_at":"2026-01-12T03:13:15.84038+08:00","dependencies":[{"issue_id":"tinyccmbt-1.2","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-11T03:21:07.640388+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-2","title":"MoonBit lexer+preprocessor","description":"Implement tokenization and C preprocessor (macros, includes, conditional compilation) in MoonBit, based on refs/tinycc/tccpp.c and tcctok.h.\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T15:34:08.895799+08:00","created_by":"agent","updated_at":"2026-01-11T03:21:23.03184+08:00","closed_at":"2026-01-11T03:21:23.03184+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-2","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.887153+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3","title":"MoonBit parser+types+sem","description":"Implement C parser, types, and semantic analysis in MoonBit (AST, symbol tables, type checking) based on refs/tinycc/tccgen.c.\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"Added alignof support: parse __alignof/__alignof__/_Alignof with sizeof-style disambiguation; sem evaluates alignof in constant expressions. Apply decl-level type attrs (aligned/packed) on typedef/var declarators by wrapping resolved type so type_size_align sees them; tests added.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-09T15:34:11.562419+08:00","created_by":"agent","updated_at":"2026-01-13T16:23:58.621607+08:00","dependencies":[{"issue_id":"tinyccmbt-3","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.823653+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.1","title":"Expand parser/sem for statements and declarations","description":"Add control-flow statements (if/while/for/switch), richer declarators (arrays, function pointers, structs/unions/enums/typedef), and improve semantic analysis (forward decls, pointer ops).\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T18:49:56.906427+08:00","created_by":"agent","updated_at":"2026-01-10T02:44:27.074987+08:00","closed_at":"2026-01-10T02:44:27.074987+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-3.1","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.241424+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.2","title":"Parser/sem: type sizes, conversions, storage classes","description":"Implement type sizes/ranks, usual arithmetic conversions, and storage-class semantics (extern/static/register/auto) consistent with refs/tinycc/tccgen.c.\\n\\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T03:39:45.642693+08:00","created_by":"agent","updated_at":"2026-01-11T02:29:21.531021+08:00","closed_at":"2026-01-11T02:29:21.531021+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-3.2","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-10T03:39:45.643577+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.3","title":"Initializer semantics: const expr/designators/array sizing","description":"Implement constant-expression evaluation for bitfield widths and designator indices, infer array sizes from initializer lists, and handle aggregate initializer rules per refs/tinycc/tccgen.c.\\n\\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T03:39:55.791425+08:00","created_by":"agent","updated_at":"2026-01-11T02:44:26.954721+08:00","closed_at":"2026-01-11T02:44:26.954721+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-3.3","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-10T03:39:55.792071+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.4","title":"Const expr: support sizeof in constant expressions","description":"Allow sizeof in constant-expression evaluation for enums, bitfield widths, and designator indices (eval_const_expr_value), aligned with refs/tinycc/tccgen.c. Keep implementation as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-11T02:49:09.447703+08:00","created_by":"agent","updated_at":"2026-01-11T02:57:13.534937+08:00","closed_at":"2026-01-11T02:57:13.534937+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-3.4","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-11T02:49:09.448592+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.5","title":"Sem: integer literal type selection by value/base","description":"Implement C integer literal typing based on value and base (decimal vs hex/octal), matching refs/tinycc/tccgen.c constant handling. Current sem picks type only from suffix.","notes":"Implemented integer literal type selection by base/value (decimal vs hex/octal) with manual UInt64 parsing to handle 0b/0x prefixes; added tests for type selection.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T02:11:30.008535+08:00","created_by":"agent","updated_at":"2026-01-12T02:44:43.778157+08:00","closed_at":"2026-01-12T02:44:43.778159+08:00","dependencies":[{"issue_id":"tinyccmbt-3.5","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-12T02:11:30.009142+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.6","title":"Sem: allow compatible global redeclarations","description":"Relax global variable redeclaration checks to allow compatible types (including incomplete/complete arrays) like refs/tinycc; update type compatibility for arrays with unknown size.","notes":"Allowed compatible global redeclarations (including incomplete array completion), updated array type compatibility, and added tests for compatible/incompatible redecls.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T02:11:39.230212+08:00","created_by":"agent","updated_at":"2026-01-12T02:44:59.475715+08:00","closed_at":"2026-01-12T02:44:59.475716+08:00","dependencies":[{"issue_id":"tinyccmbt-3.6","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-12T02:11:39.230805+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-3.7","title":"Parser/sem: typeof and __attribute__ support","description":"Implement GNU C typeof expressions and __attribute__ parsing/typing per refs/tinycc/tccgen.c and tccpp.c. Add AST nodes, parser handling, and semantic checks; keep behavior as close as possible to refs/tinycc.","notes":"Added call-convention handling for function types/signatures (normalize/merge, apply to declarators/params/fields), parse __attribute__ after struct closing brace, clamp regparm to 1..3, and added tests for trailing packed struct + callconv compat; extended CType::Function with call_conv and FuncSig checks. Parse __attribute__ inside pointer declarators (before/after '*') and after labels; added tests for label attributes and pointer call-conv parsing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T18:42:49.402173+08:00","created_by":"agent","updated_at":"2026-01-13T02:00:35.156332+08:00","closed_at":"2026-01-13T02:00:35.156332+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-3.7","depends_on_id":"tinyccmbt-3","type":"parent-child","created_at":"2026-01-12T18:42:49.403068+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-4","title":"MoonBit arm64 codegen","description":"Implement arm64 code generation in MoonBit (instruction selection, register allocation), based on refs/tinycc/arm64-gen.c.\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"Codegen scaffolding extended: supports 'int main(){return x;}' for an uninitialized non-extern global. Emits ADRP+ADD relocations (R_AARCH64_ADR_PREL_PG_HI21 + R_AARCH64_ADD_ABS_LO12_NC) and LDR w0,[x0]; also emits a .bss section for the global symbol; wbtest asserts emitted relocs.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-09T15:34:17.064559+08:00","created_by":"agent","updated_at":"2026-01-13T17:06:35.262174+08:00","dependencies":[{"issue_id":"tinyccmbt-4","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.75899+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-5","title":"MoonBit Mach-O writer","description":"Implement Mach-O writer for arm64 object files in MoonBit, based on refs/tinycc/tccmacho.c.\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"Mach-O reloc mapping extended to cover more arm64 relocation kinds used by refs/tinycc/tccmacho.c (CALL26/JUMP26, ADR_PREL_PG_HI21(_NC), ADD_ABS_LO12_NC, LDST8_ABS_LO12_NC) with correct Mach-O ARM64_RELOC_* types; wbtest added for mapping.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-09T15:34:20.735493+08:00","created_by":"agent","updated_at":"2026-01-13T16:51:16.086865+08:00","dependencies":[{"issue_id":"tinyccmbt-5","depends_on_id":"tinyccmbt-4","type":"blocks","created_at":"2026-01-09T17:12:10.453809+08:00","created_by":"import"},{"issue_id":"tinyccmbt-5","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.695078+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-6","title":"MoonBit CLI/build integration","description":"Implement CLI flags and build integration for compiler pipeline (preprocess/compile to .o).\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"CLI now uses TheWaWaR/clap for -c/-o and positional input parsing; -I include paths are still collected/normalized manually (supports -I\u003cpath\u003e) and passed to preprocessor include search. Non-compile mode still token-dumps from preprocessor.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-09T15:34:25.634198+08:00","created_by":"agent","updated_at":"2026-01-13T16:56:20.275577+08:00","dependencies":[{"issue_id":"tinyccmbt-6","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.630899+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-6ee","title":"Preprocessor macro recursion and whitespace handling","description":"Add recursion guard/disabled set for macro expansion, track whitespace to distinguish function-like macro invocation, and refine argument expansion order per C rules.\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T18:05:43.042885+08:00","created_by":"agent","updated_at":"2026-01-10T01:40:41.725762+08:00","closed_at":"2026-01-09T18:26:45.257308+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-6ee","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.370266+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-7","title":"Use clap.mbt for cli args; See: https://github.com/TheWaWaR/clap.mbt","description":"Use clap.mbt for CLI argument parsing; see https://github.com/TheWaWaR/clap.mbt.\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"Switched CLI argument parsing to TheWaWaR/clap (keep behavior close to tinycc): clap parses -c/-o and positional input; -I include paths (including -I\u003cpath\u003e) are normalized/collected and then passed into preprocessor include search. Unknown flags remain ignored for now. Added wbtests for CLI parsing.","status":"closed","priority":2,"issue_type":"task","assignee":"agent","created_at":"2026-01-09T16:48:40.290709+08:00","created_by":"agent","updated_at":"2026-01-13T16:51:14.638348+08:00","closed_at":"2026-01-13T16:51:14.638348+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-7","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.565633+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-8","title":"Preprocessor directives and macro expansion","description":"Implement #define/#undef macros, conditional compilation (#if/#ifdef/#ifndef/#elif/#endif), and #include handling, using lexer line_start for directive detection. Base behavior on refs/tinycc/tccpp.c.\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T17:02:10.244182+08:00","created_by":"agent","updated_at":"2026-01-10T01:40:41.597333+08:00","closed_at":"2026-01-09T17:49:52.625255+08:00","dependencies":[{"issue_id":"tinyccmbt-8","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.499865+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-9","title":"Preprocessor: function-like macros and #if expression eval","description":"Extend macro expansion with function-like macros, variadics, token pasting/stringizing, and evaluate #if expressions (basic operators, arithmetic, defined). Also implement include search paths beyond current file directory.\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T17:50:00.078519+08:00","created_by":"agent","updated_at":"2026-01-10T01:40:41.660997+08:00","closed_at":"2026-01-09T18:05:30.711626+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-9","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.434746+08:00","created_by":"agent"}]}
{"id":"tinyccmbt-980","title":"arm64: implement arm64_sym and relocation hooks","description":"arm64_sym emits ADRP/LD GOT reloc entries into Arm64Emitter.relocs; added Section/Reloc scaffolding with section_from_emitter to carry code+relocs. Still need real object writer (Mach-O/ELF) and symbol/reloc tables per refs/tinycc.\n\nImplementation must stay as close as possible to refs/tinycc.","notes":"Codegen now emits non-GOT symbol address relocs for a simple global load (ADRP+ADD with R_AARCH64_ADR_PREL_PG_HI21 + R_AARCH64_ADD_ABS_LO12_NC) and Mach-O mapping covers these kinds; wbtest validates relocation records.","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-12T00:14:55.685349+08:00","created_by":"agent","updated_at":"2026-01-13T17:06:42.211682+08:00"}
{"id":"tinyccmbt-oix","title":"Parser: support K\u0026R old-style function definitions","description":"Handle K\u0026R-style function definitions with identifier parameter lists plus trailing parameter declarations (e.g., int f(a,b) int a; char b; { ... }), mirroring refs/tinycc tccgen.c. Ensure old-style parameter default promotions are applied where required.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-12T16:12:18.732042+08:00","created_by":"agent","updated_at":"2026-01-12T16:26:32.098125+08:00","closed_at":"2026-01-12T16:26:32.098125+08:00","close_reason":"Closed"}
{"id":"tinyccmbt-z96","title":"Preprocessor include path configuration","description":"Wire include path list (-I) into preprocessor, using add_include_path and search order for angle/quote includes.\n\nImplementation must stay as close as possible to refs/tinycc.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T18:26:57.403146+08:00","created_by":"agent","updated_at":"2026-01-11T03:26:23.291996+08:00","closed_at":"2026-01-11T03:26:23.291996+08:00","close_reason":"Closed","dependencies":[{"issue_id":"tinyccmbt-z96","depends_on_id":"tinyccmbt-1","type":"parent-child","created_at":"2026-01-10T01:45:51.30597+08:00","created_by":"agent"}]}
